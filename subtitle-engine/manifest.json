{
  "id": "subtitle-engine",
  "name": "Subtitle Engine",
  "version": "0.9.2",
  "manifestURI": "https://raw.githubusercontent.com/Thekingcrusher/seanime-plugins/refs/heads/main/subtitle-engine/manifest.json",
  "language": "typescript",
  "type": "plugin",
  "description": "Add subtitles of your preferred language and format scraped from multiple different sources to your current session.",
  "author": "Thekingcrusher",
  "icon": "https://raw.githubusercontent.com/Thekingcrusher/seanime-plugins/refs/heads/main/subtitle-engine/icon.png",
  "lang": "multi",
  "payload": "/// \u003creference path=\"../../core.d.ts\" /\u003e\n/// \u003creference path=\"../../plugin.d.ts\" /\u003e\n/// \u003creference path=\"../../app.d.ts\" /\u003e\n/// \u003creference path=\"../../system.d.ts\" /\u003e\n\n//@ts-ignore\nfunction init() {\n    $ui.register((ctx) =\u003e {\n        const tray = ctx.newTray({\n            iconUrl: \"https://raw.githubusercontent.com/Thekingcrusher/seanime-plugins/refs/heads/main/subtitle-engine/icon.png\",\n            withContent: true,\n            width: \"600px\"\n        })\n\n        // --- States \u0026 Refs ---\n        const imdbId = ctx.state\u003cstring\u003e(\"\")\n        const seasonNumber = ctx.state\u003cstring\u003e(\"\")\n        const episodeNumber = ctx.state\u003cstring\u003e(\"\")\n        const subtitleResults = ctx.state\u003cany[]\u003e([])\n        const isSearching = ctx.state\u003cboolean\u003e(false)\n        const lastSearchedKey = ctx.state\u003cstring\u003e(\"\")\n        const selectedSubUrls = ctx.state\u003cstring[]\u003e([])\n        const activeSession = ctx.state\u003cboolean\u003e(false)\n\n        const imdbRef = ctx.fieldRef()\n        const seasonRef = ctx.fieldRef()\n        const episodeRef = ctx.fieldRef()\n        const langRef = ctx.fieldRef\u003cstring\u003e($getUserPreference(\"language\"))\n        const sourceRef = ctx.fieldRef\u003cstring\u003e($getUserPreference(\"source\"))\n        const formatRef = ctx.fieldRef\u003cstring\u003e($getUserPreference(\"format\"))\n        \n        const hiRef = ctx.fieldRef\u003cboolean\u003e(false)\n        const savedHi = $getUserPreference(\"hi\")\n        hiRef.setValue(savedHi === true || savedHi === \"true\")\n\n        async function injectSubtitle(sub: any) {\n            try {\n                const content = await fetch(sub.url).then(r =\u003e r.text());\n                const match = sub.media.match(/^\\[(.*?)\\]/) || sub.media.match(/26[45]-(.+?)(?=\\s|$|\\()/);\n                const label = match \n                    ? `[${match[1]}] ${sub.display} ${sub.isHearingImpaired ? \"[CC]\" : \"\"} (${sub.format})`\n                    : `${sub.display} ${sub.isHearingImpaired ? \"[CC]\" : \"\"} (${sub.format}) [${sub.source}]`;\n\n                ctx.videoCore.addExternalSubtitleTrack({\n                    label,\n                    language: sub.language,\n                    content,\n                    type: sub.format.toLowerCase(),\n                });\n                \n                selectedSubUrls.set([...selectedSubUrls.get(), sub.url]);\n            } catch (err) {\n                ctx.toast.error(\"Failed to inject subtitle\");\n            }\n        }\n\n        async function loadMediaData(anilistId: number) {\n            try {\n                const metadata = await ctx.anime.getAnimeMetadata(\"anilist\", anilistId)\n                const info = ctx.videoCore.getCurrentPlaybackInfo();\n                const mappingImdb = metadata.mappings?.imdbId?.toString();\n                const mappingTmdb = metadata.mappings?.themoviedbId?.toString();\n                const currentSeason = metadata.episodes[\"1\"]?.seasonNumber?.toString();\n                const currentEpisode = info.episode?.episodeNumber?.toString();\n                const currentFormat = info.media?.format?.toUpperCase();\n\n                const bestId = mappingTmdb || mappingImdb;\n                const fallback = !bestId || !currentSeason;\n                const method = $getUserPreference(\"method\");\n    \n                if (bestId) {\n                    imdbId.set(bestId);\n                    imdbRef.setValue(bestId);\n                }\n\n                if (currentSeason !== \"0\") {\n                  seasonNumber.set(currentSeason);\n                  seasonRef.setValue(currentSeason);\n                  episodeNumber.set(currentEpisode);\n                  episodeRef.setValue(currentEpisode);\n                }\n        \n                if (fallback \u0026\u0026 currentFormat !== \"MOVIE\") {\n                    console.log(`Metadata missing IDs, falling back to ID mapping method ${method}.`);\n                    \n                    if (method === \"1\") {\n                        const anidbId = metadata.mappings.anidbId;\n                        const res = await fetch(\"https://raw.githubusercontent.com/Anime-Lists/anime-lists/refs/heads/master/anime-list-full.xml\");\n                        const xmlText = await res.text();\n                        const $ = LoadDoc(xmlText);\n                        const animeNode = $(`anime[anidbid=\"${anidbId}\"]`);\n    \n                        if (animeNode.length) {\n                            const tmdbId = animeNode.attr(\"tmdbtv\");\n                            const tmdbSeason = animeNode.attr(\"defaulttvdbseason\");\n                            if (tmdbId) { imdbId.set(tmdbId); imdbRef.setValue(tmdbId); }\n                            if (tmdbSeason !== \"0\") { seasonNumber.set(tmdbSeason); seasonRef.setValue(tmdbSeason); episodeNumber.set(currentEpisode); episodeRef.setValue(currentEpisode); }\n                        }\n                    } else if (method === \"2\") {\n                        const res = await fetch(`https://ramregar97-idmapper.hf.space/api/mapper?anilist_id=${anilistId}`);\n                        const data = await res.json();\n                        imdbId.set(data.tmdb_show_id?.toString() || data.themoviedb_id?.toString() || data.imdb_id?.toString());\n                        imdbRef.setValue(data.tmdb_show_id?.toString() || data.themoviedb_id?.toString() || data.imdb_id?.toString());\n                        const keys = data.tvdb_mappings ? Object.keys(data.tvdb_mappings) : [];\n                        if (keys.length \u003e 0) {\n                            const sNum = keys[0].replace(\"s\", \"\");\n                            if (sNum !== \"0\") {\n                                seasonNumber.set(sNum);\n                                seasonRef.setValue(sNum);\n                                episodeNumber.set(currentEpisode);\n                                episodeRef.setValue(currentEpisode);\n                            }\n                        }\n                    }\n                }\n\n                if (!bestId \u0026\u0026 currentFormat === \"MOVIE\") {\n                    console.log(`Metadata missing IDs, falling back to ID mapping movie method ${method}.`);\n                    \n                    if (method === \"1\") {\n                        const anidbId = metadata.mappings.anidbId;\n                        const res = await fetch(\"https://raw.githubusercontent.com/Anime-Lists/anime-lists/refs/heads/master/anime-list-full.xml\");\n                        const xmlText = await res.text();\n                        const $ = LoadDoc(xmlText);\n                        const animeNode = $(`anime[anidbid=\"${anidbId}\"]`);\n    \n                        if (animeNode.length) {\n                            const tmdbId = animeNode.attr(\"tmdbid\");\n                            const imdbid = animeNode.attr(\"imdbid\");\n                            const tmdbSeason = animeNode.attr(\"defaulttvdbseason\");\n                            imdbId.set(tmdbId || imdbid);\n                            imdbRef.setValue(tmdbId || imdbid);\n                            if (tmdbSeason !== \"0\") { seasonNumber.set(tmdbSeason); seasonRef.setValue(tmdbSeason); episodeNumber.set(currentEpisode); episodeRef.setValue(currentEpisode); }\n                        }\n                    } else if (method === \"2\") {\n                        const res = await fetch(`https://ramregar97-idmapper.hf.space/api/mapper?anilist_id=${anilistId}`);\n                        const data = await res.json();\n                        imdbId.set(data.tmdb_movie_id?.toString() || data.themoviedb_id?.toString() || data.imdb_id?.toString());\n                        imdbRef.setValue(data.tmdb_movie_id?.toString() || data.themoviedb_id?.toString() || data.imdb_id?.toString());\n                        const keys = data.tvdb_mappings ? Object.keys(data.tvdb_mappings) : [];\n                        if (keys.length \u003e 0) {\n                            const sNum = keys[0].replace(\"s\", \"\");\n                            if (sNum !== \"0\") {\n                                seasonNumber.set(sNum);\n                                seasonRef.setValue(sNum);\n                                episodeNumber.set(currentEpisode);\n                                episodeRef.setValue(currentEpisode); \n                            }\n                        }\n                    }\n                }\n\n                const search = $getUserPreference(\"autoSearch\") === \"true\" || $getUserPreference(\"autoSelect\") === \"true\"\n                  \n                if (search \u0026\u0026 imdbRef.current) {\n                    await fetchSubtitles(true);\n                    let results = subtitleResults.get();\n                  \n                    if (results.length === 0 \u0026\u0026 formatRef.current !== \"all\" \u0026\u0026 $getUserPreference(\"fallback\") === \"true\") {\n                        await fetchSubtitles(true, { format: \"all\" });\n                        results = subtitleResults.get();\n                    }\n                    if (results.length === 0 \u0026\u0026 hiRef.current \u0026\u0026 $getUserPreference(\"fallback\") === \"true\") {\n                        await fetchSubtitles(true, { format: \"all\", hi: false });\n                        results = subtitleResults.get();\n                    }\n                    if ($getUserPreference(\"autoSelect\") === \"true\") {\n                        if (results.length \u003e 0) {\n                            await injectSubtitle(results[0]);\n                        } else {\n                            ctx.toast.warning(\"Auto Select could not find any subtitles\");\n                        }\n                    }\n                }\n            } catch (e) {\n                console.error(\"Mapping error\", e);\n            }\n        }\n\n        async function fetchSubtitles(isAuto = false, overrides = {}) {\n            const id = imdbRef.current || imdbId.get();\n            const s = seasonRef.current || seasonNumber.get();\n            const ep = episodeRef.current || episodeNumber.get();\n            const source = overrides.source || sourceRef.current;\n            const format = overrides.format || formatRef.current;\n            const lang = overrides.lang || langRef.current;\n            const hi = overrides.hi !== undefined ? overrides.hi : hiRef.current;\n            if (!id) {\n              ctx.toast.warning(\"IMDB/TMDB ID not found\")\n              return\n            }\n\n            const currentKey = `${id}-${s}-${ep}-${source}-${format}-${lang}-${hi}`;\n            if (isAuto \u0026\u0026 lastSearchedKey.get() === currentKey) return;\n\n            isSearching.set(true);\n            try {\n                let url = `https://sub.wyzie.ru/search?id=${id}`;\n                if (s \u0026\u0026 ep) url += `\u0026season=${s}\u0026episode=${ep}`;\n                if (source !== \"opensubtitles\") url += `\u0026source=${source}`;\n                if (format !== \"all\") url += `\u0026format=${format}`;\n                if (lang !== \"all\") url += `\u0026language=${lang}`;\n                if (hi) url += `\u0026isHearingImpaired=true`;\n                console.log(url)\n\n                const res = await fetch(url);\n                const data = await res.json();\n                subtitleResults.set(Array.isArray(data) ? data : []);\n                lastSearchedKey.set(currentKey);\n            } catch (err) {\n                ctx.toast.error(\"Subtitle search failed\");\n            } finally {\n                isSearching.set(false);\n            }\n        }\n\n        ctx.registerEventHandler(\"triggerManualSearch\", () =\u003e {\n            const id = imdbRef.current;\n            const s = seasonRef.current;\n            const e = episodeRef.current;\n          \n            if (!id) return ctx.toast.warning(\"IMDB/TMDB ID is required\");\n            if (s \u0026\u0026 !e) return ctx.toast.warning(\"Episode number required\");\n            if (!s \u0026\u0026 e) return ctx.toast.warning(\"Season number required\");\n\n            if (activeSession.get()) {\n                fetchSubtitles(false);\n            }\n        });\n        \n        ctx.screen.onNavigate(async (e) =\u003e {\n            if (e.pathname === \"/entry\" \u0026\u0026 e.searchParams.id) {\n                activeSession.set(true);\n                selectedSubUrls.set([]);\n                langRef.setValue($getUserPreference(\"language\"));\n                sourceRef.setValue($getUserPreference(\"source\"));\n                formatRef.setValue($getUserPreference(\"format\"));\n                if ($getUserPreference(\"autoSelect\") === \"true\") {\n                    ctx.videoCore.addEventListener(\"video-loaded\", () =\u003e loadMediaData(parseInt(e.searchParams.id)));\n                }\n            }\n            else activeSession.set(false)\n        });\n\n        tray.onOpen(() =\u003e {\n            if (activeSession.get()) {\n                const info = ctx.videoCore.getCurrentPlaybackInfo();\n                if (info) {\n                    loadMediaData(parseInt(info.media.id));\n                } else {\n                    ctx.videoCore.addEventListener(\"video-loaded\", (event) =\u003e {\n                        const info = ctx.videoCore.getCurrentPlaybackInfo();\n                        if (info) loadMediaData(parseInt(info.media.id));\n                    });\n                }\n              \n            }\n        })\n\n        tray.render(() =\u003e {\n            const subs = subtitleResults.get() || [];\n            const currentlySelectedList = selectedSubUrls.get() || [];\n\n            return tray.div([\n                tray.css(`                 \n                    .subtitle-item { transition: all 0.3s ease !important; margin: 0 8px; border-radius: 8px !important; }\n                    .subtitle-item:hover { background-color: rgba(255, 255, 255, 0.10) !important; }\n                `),\n                tray.div([\n                    tray.div([\n                        tray.flex([\n                            tray.stack([\n                                tray.text(\"Subtitle Engine\", { style: { fontSize: \"18px\", fontWeight: \"700\", color: \"#FFF\" } }),\n                                tray.text(\"Powered by Wyzie\", { style: { fontSize: \"11px\", opacity: 0.5 } })\n                            ]),\n                            isSearching.get() \n                                ? tray.badge(\"Syncing Providers...\", { intent: \"warning\" }) \n                                : tray.badge(`${subs.length} items found`, { intent: subs.length \u003e 0 ? \"success\" : \"gray\" })\n                        ], { justifyContent: \"space-between\", alignItems: \"center\" })\n                    ], { style: { padding: \"20px 20px 15px 20px\" } }),\n\n                    tray.stack([\n                        tray.flex([\n                            tray.input({ label: \"IMDB/TMDB ID\", fieldRef: imdbRef, style: { flex: 2 } }),\n                            tray.input({ label: \"S\", fieldRef: seasonRef, style: { width: \"55px\" } }),\n                            tray.input({ label: \"E\", fieldRef: episodeRef, style: { width: \"55px\" } }),\n                            tray.button({ \n                                label: \"Search\", \n                                onClick: \"triggerManualSearch\", \n                                intent: isSearching.get() ? \"gray\" : \"white-subtle\",\n                                disabled: isSearching.get(),\n                                style: { marginTop: \"24px\", height: \"38px\" } \n                            })\n                        ], { gap: 1 }),\n\n                        tray.flex([\n                            tray.select(\"Source\", {\n                                fieldRef: sourceRef,\n                                options: [\n                                  { label: \"AnimeTosho\", value: \"animetosho\" },\n                                  { label: \"SubDL\", value: \"subdl\" },\n                                  { label: \"Subf2m\", value: \"subf2m\" },\n                                  { label: \"OpenSubtitles\", value: \"opensubtitles\" },\n                                  { label: \"Podnapisi\", value: \"podnapisi\" },\n                                  { label: \"Gestdown\", value: \"gestdown\" }\n                                ],\n                                style: { flex: 1 }\n                            }),\n                            tray.select(\"Language\", {\n                                fieldRef: langRef,\n                                options: [\n                                    { label: \"All\", value: \"all\" },\n                                    { label: \"English\", value: \"en\" },\n                                    { label: \"Spanish (Spain)\", value: \"es\" },\n                                    { label: \"Spanish (LATAM)\", value: \"ea\" },\n                                    { label: \"French\", value: \"fr\" },\n                                    { label: \"German\", value: \"de\" },\n                                    { label: \"Italian\", value: \"it\" },\n                                    { label: \"Portuguese (PT)\", value: \"pt\" },\n                                    { label: \"Portuguese (BR)\", value: \"pb\" },\n                                    { label: \"Japanese\", value: \"ja\" },\n                                    { label: \"Korean\", value: \"ko\" },\n                                    { label: \"Chinese (Simplified)\", value: \"zh\" },\n                                    { label: \"Chinese (Traditional)\", value: \"zt\" },\n                                    { label: \"Russian\", value: \"ru\" },\n                                    { label: \"Arabic\", value: \"ar\" },\n                                    { label: \"Turkish\", value: \"tr\" },\n                                    { label: \"Indonesian\", value: \"id\" },\n                                    { label: \"Vietnamese\", value: \"vi\" },\n                                    { label: \"Thai\", value: \"th\" },\n                                    { label: \"Hindi\", value: \"hi\" },\n                                    { label: \"Bengali\", value: \"bn\" },\n                                    { label: \"Malay\", value: \"ms\" },\n                                    { label: \"Tagalog\", value: \"tl\" },\n                                    { label: \"Persian\", value: \"fa\" },\n                                    { label: \"Hebrew\", value: \"he\" },\n                                    { label: \"Polish\", value: \"pl\" },\n                                    { label: \"Dutch\", value: \"nl\" },\n                                    { label: \"Greek\", value: \"el\" },\n                                    { label: \"Czech\", value: \"cs\" },\n                                    { label: \"Hungarian\", value: \"hu\" },\n                                    { label: \"Romanian\", value: \"ro\" },\n                                    { label: \"Swedish\", value: \"sv\" },\n                                    { label: \"Danish\", value: \"da\" },\n                                    { label: \"Finnish\", value: \"fi\" },\n                                    { label: \"Norwegian\", value: \"no\" },\n                                    { label: \"Ukrainian\", value: \"uk\" },\n                                    { label: \"Bulgarian\", value: \"bg\" },\n                                    { label: \"Slovak\", value: \"sk\" },\n                                    { label: \"Croatian\", value: \"hr\" },\n                                    { label: \"Serbian\", value: \"sr\" },\n                                    { label: \"Slovenian\", value: \"sl\" },\n                                    { label: \"Lithuanian\", value: \"lt\" },\n                                    { label: \"Latvian\", value: \"lv\" },\n                                    { label: \"Estonian\", value: \"et\" },\n                                    { label: \"Icelandic\", value: \"is\" },\n                                    { label: \"Albanian\", value: \"sq\" },\n                                    { label: \"Armenian\", value: \"hy\" },\n                                    { label: \"Azerbaijani\", value: \"az\" },\n                                    { label: \"Basque\", value: \"eu\" },\n                                    { label: \"Belarusian\", value: \"be\" },\n                                    { label: \"Bosnian\", value: \"bs\" },\n                                    { label: \"Catalan\", value: \"ca\" },\n                                    { label: \"Galician\", value: \"gl\" },\n                                    { label: \"Georgian\", value: \"ka\" },\n                                    { label: \"Gujarati\", value: \"gu\" },\n                                    { label: \"Kazakh\", value: \"kk\" },\n                                    { label: \"Khmer\", value: \"km\" },\n                                    { label: \"Macedonian\", value: \"mk\" },\n                                    { label: \"Malayalam\", value: \"ml\" },\n                                    { label: \"Marathi\", value: \"mr\" },\n                                    { label: \"Mongolian\", value: \"mn\" },\n                                    { label: \"Nepali\", value: \"ne\" },\n                                    { label: \"Punjabi\", value: \"pa\" },\n                                    { label: \"Sinhala\", value: \"si\" },\n                                    { label: \"Tamil\", value: \"ta\" },\n                                    { label: \"Telugu\", value: \"te\" },\n                                    { label: \"Urdu\", value: \"ur\" },\n                                    { label: \"Uzbek\", value: \"uz\" },\n                                    { label: \"Welsh\", value: \"cy\" }\n                                ],\n                                style: { flex: 1 }\n                            }),\n                            tray.select(\"Format\", {\n                                fieldRef: formatRef,\n                                options: [\n                                  { label: \"All\", value: \"all\" },\n                                  { label: \"ASS\", value: \"ass\" },\n                                  { label: \"SSA\", value: \"ssa\" },\n                                  { label: \"SRT\", value: \"srt\" },\n                                  { label: \"VTT\", value: \"vtt\" }\n                                ],\n                                style: { flex: 1 }\n                            })\n                        ], { gap: 1 }),\n\n                        tray.flex([\n                            tray.switch(\"Closed Captions (CC)\", { fieldRef: hiRef }),\n                        ], { padding: \"4px 0\" })\n                    ], { style: { padding: \"0 20px 20px 20px\", borderBottom: \"3px solid rgba(255,255,255,0.08)\" }, gap: 1.2 }),\n\n                    tray.div([\n                        isSearching.get() ? \n                            tray.div([tray.text(\"Searching...\", { style: { textAlign: \"center\", padding: \"60px\", opacity: 0.5 } })]) : \n                        subs.length === 0 ?\n                            tray.stack([\n                                (activeSession.get() \u0026\u0026 [\"es\", \"ea\", \"pb\", \"pt\", \"zh\", \"zt\"].includes(langRef.current)) ?\n                                    tray.alert({\n                                        title: \"Smart Tip\",\n                                        description: \n                                            langRef.current === \"es\" ? \"Try switching to Spanish (LATAM). It might contain Spanish (Spain).\" :\n                                            langRef.current === \"ea\" ? \"Try switching to Spanish (Spain). It might contain Spanish (LATAM).\" :\n                                            langRef.current === \"pb\" ? \"Try switching to Portuguese (PT). It might contain Portuguese (BR).\" :\n                                            langRef.current === \"pt\" ? \"Try switching to Portuguese (BR). It might contain Portuguese (PT).\" :\n                                            langRef.current === \"zt\" ? \"Try switching to Chinese (Traditional). It might contain Chinese (Simplified)\" :\n                                            \"Try switching to Chinese (Simplified). It might contain Chinese (Traditional).\",\n                                        intent: \"info\",\n                                        style: { margin: \"20px 20px 0px 20px\" }\n                                    }) : tray.div([]),\n                        \n                                activeSession.get() ? \n                                    tray.alert({\n                                        title: \"No Results\",\n                                        description: \"Try changing your search parameters or source.\",\n                                        intent: \"warning\",\n                                        style: { margin: \"20px\" }\n                                    }) : \n                                    tray.alert({\n                                        title: \"No Active Session Found\",\n                                        description: \"Subtitle Engine is only compatible with Seanime's built-in player. Please start a video for auto search, or enter an ID manually.\",\n                                        intent: \"warning\",\n                                        style: { margin: \"20px\" }\n                                    })\n                            ]) :\n                        tray.stack(subs.map((sub, i) =\u003e {\n                            const isThisSelected = currentlySelectedList.includes(sub.url);\n\n                            return tray.flex([\n                                tray.stack([\n                                    tray.text(sub.release, { style: { fontSize: \"15px\", fontWeight: \"600\", color: \"#efefef\" }, maxLines: 1 }),\n                                    tray.flex([\n                                        tray.flex([\n                                            tray.img(sub.flagUrl, { style: { width: \"18px\", height: \"12px\", borderRadius: \"1px\", objectFit: \"cover\", flexShrink: 0 } }),\n                                            tray.text(`${sub.display.toUpperCase()} (${sub.language.toUpperCase()})`, { \n                                                style: { fontSize: \"12px\", fontWeight: \"700\", color: \"rgba(255,255,255,0.9)\", whiteSpace: \"nowrap\", lineHeight: \"12px\", marginTop: \"0.5px\" } \n                                            })\n                                        ], { gap: 0.6, alignItems: \"center\", style: { backgroundColor: \"rgba(255,255,255,0.12)\", padding: \"2px 8px\", borderRadius: \"100px\", border: \"1px solid rgba(255,255,255,0.2)\", height: \"18px\", flexShrink: 0 } }),\n                                        tray.badge(sub.format.toUpperCase(), { intent: \"primary\", size: \"sm\" }),\n                                        sub.isHearingImpaired ? tray.badge(\"HI\", { intent: \"warning\", size: \"sm\" }) : tray.div([]),\n                                        tray.text(`â€¢ ${sub.source}`, { style: { fontSize: \"11px\", opacity: 0.4, marginLeft: \"2px\" } })\n                                    ], { gap: 0.8, alignItems: \"center\" })\n                                ], { style: { flex: 1 }, gap: 0.5 }),\n\n                                tray.button({\n                                    label: isThisSelected ? \"Added\" : \"Select\",\n                                    size: \"sm\",\n                                    intent: isThisSelected ? \"gray\" : \"primary\",\n                                    disabled: isThisSelected,\n                                    onClick: ctx.eventHandler(`inject-${i}`, () =\u003e injectSubtitle(sub))\n                                })\n                            ], { \n                                className: \"subtitle-item\",\n                                style: { padding: \"14px 20px\", borderBottom: \"3px solid rgba(255,255,255,0.08)\", alignItems: \"center\", marginTop: i === 0 ? \"8px\" : \"0\" } \n                            })\n                        }))\n                    ])\n                ], { style: { display: \"flex\", flexDirection: \"column\", height: \"100%\" } })\n            ], { style: { width: \"100%\", height: \"100%\" } })\n        })\n    })\n}",
  "userConfig": {
    "version": 1,
    "requiresConfig": false,
    "fields": [
      {
        "type": "switch",
        "name": "autoSearch",
        "label": "Auto Search",
        "default": "true"
      },
      {
        "type": "switch",
        "name": "autoSelect",
        "label": "Auto Select",
        "default": "false"
      },
      {
        "type": "switch",
        "name": "fallback",
        "label": "Smart Select (Requires auto select)",
        "default": "false"
      },
      {
        "type": "switch",
        "name": "hi",
        "label": "Closed Caption (CC)",
        "default": "false"
      },
      {
        "type": "select",
        "name": "source",
        "label": "Source",
        "options": [
          { "value": "animetosho", "label": "AnimeTosho" },
          { "value": "subdl", "label": "SubDL" },
          { "value": "subf2m", "label": "Subf2m" },
          { "value": "opensubtitles", "label": "OpenSubtitles" },
          { "value": "podnapisi", "label": "Podnapisi" },
          { "value": "gestdown", "label": "Gestdown" }
        ],
        "default": "animetosho"
      },
      {
        "type": "select",
        "name": "language",
        "label": "Language",
        "options": [
          { "label": "All", "value": "all" },
          { "label": "English", "value": "en" },
          { "label": "Spanish (Spain)", "value": "es" },
          { "label": "Spanish (LATAM)", "value": "ea" },
          { "label": "French", "value": "fr" },
          { "label": "German", "value": "de" },
          { "label": "Italian", "value": "it" },
          { "label": "Portuguese (PT)", "value": "pt" },
          { "label": "Portuguese (BR)", "value": "pb" },
          { "label": "Japanese", "value": "ja" },
          { "label": "Korean", "value": "ko" },
          { "label": "Chinese (Simplified)", "value": "zh" },
          { "label": "Chinese (Traditional)", "value": "zt" },
          { "label": "Russian", "value": "ru" },
          { "label": "Arabic", "value": "ar" },
          { "label": "Turkish", "value": "tr" },
          { "label": "Indonesian", "value": "id" },
          { "label": "Vietnamese", "value": "vi" },
          { "label": "Thai", "value": "th" },
          { "label": "Hindi", "value": "hi" },
          { "label": "Bengali", "value": "bn" },
          { "label": "Malay", "value": "ms" },
          { "label": "Tagalog", "value": "tl" },
          { "label": "Persian", "value": "fa" },
          { "label": "Hebrew", "value": "he" },
          { "label": "Polish", "value": "pl" },
          { "label": "Dutch", "value": "nl" },
          { "label": "Greek", "value": "el" },
          { "label": "Czech", "value": "cs" },
          { "label": "Hungarian", "value": "hu" },
          { "label": "Romanian", "value": "ro" },
          { "label": "Swedish", "value": "sv" },
          { "label": "Danish", "value": "da" },
          { "label": "Finnish", "value": "fi" },
          { "label": "Norwegian", "value": "no" },
          { "label": "Ukrainian", "value": "uk" },
          { "label": "Bulgarian", "value": "bg" },
          { "label": "Slovak", "value": "sk" },
          { "label": "Croatian", "value": "hr" },
          { "label": "Serbian", "value": "sr" },
          { "label": "Slovenian", "value": "sl" },
          { "label": "Lithuanian", "value": "lt" },
          { "label": "Latvian", "value": "lv" },
          { "label": "Estonian", "value": "et" },
          { "label": "Icelandic", "value": "is" },
          { "label": "Albanian", "value": "sq" },
          { "label": "Armenian", "value": "hy" },
          { "label": "Azerbaijani", "value": "az" },
          { "label": "Basque", "value": "eu" },
          { "label": "Belarusian", "value": "be" },
          { "label": "Bosnian", "value": "bs" },
          { "label": "Catalan", "value": "ca" },
          { "label": "Galician", "value": "gl" },
          { "label": "Georgian", "value": "ka" },
          { "label": "Gujarati", "value": "gu" },
          { "label": "Kazakh", "value": "kk" },
          { "label": "Khmer", "value": "km" },
          { "label": "Macedonian", "value": "mk" },
          { "label": "Malayalam", "value": "ml" },
          { "label": "Marathi", "value": "mr" },
          { "label": "Mongolian", "value": "mn" },
          { "label": "Nepali", "value": "ne" },
          { "label": "Punjabi", "value": "pa" },
          { "label": "Sinhala", "value": "si" },
          { "label": "Tamil", "value": "ta" },
          { "label": "Telugu", "value": "te" },
          { "label": "Urdu", "value": "ur" },
          { "label": "Uzbek", "value": "uz" },
          { "label": "Welsh", "value": "cy" }
        ],
        "default": "all"
      },
      {
        "type": "select",
        "name": "format",
        "label": "Format",
        "options": [
          { "value": "all", "label": "All" },
          { "value": "ass", "label": "ASS" },
          { "value": "ssa", "label": "SSA" },
          { "value": "srt", "label": "SRT" },
          { "value": "vtt", "label": "VTT" }
        ],
        "default": "all"
      },
      {
        "type": "select",
        "name": "method",
        "label": "ID Mapping Method (Fallback)",
        "options": [
          { "value": "1", "label": "Method 1 (Github)" },
          { "value": "2", "label": "Method 2 (Third Party Site)" }
        ],
        "default": "1"
      }
    ]
  },
  "plugin": {
    "version": "1",
    "permissions": {
      "scopes": ["playback"],
      "allow": {
        "networkAccess": {
          "allowedDomains": [
            "https://sub.wyzie.ru",
            "https://ramregar97-idmapper.hf.space"
          ],
          "reasoning": "Fetch subtitles"
        }
      }
    }
  }
}
